<!-- Generated by BMad create-story workflow -->
# Story 1.11: Definir esquema canônico de dados e documentação do modelo (schema + examples)

Status: review

## Story

As a Data Engineer / Tech Writer,
I want a canonical schema for stored CSV snapshots and a documented example file,
so that downstream consumers (notebooks, metrics) have a stable contract.

## Acceptance Criteria

- A `docs/schema.json` defines column names, types, nullable flags and semantic notes.
- An example CSV `dados/samples/ticker_example.csv` is included and referenced by `docs/schema.md` explaining column meanings and versioning strategy.
- Migration notes for schema changes are documented (minor vs breaking changes) and versioned using `schema_version` in snapshot metadata.

## Tasks / Subtasks

- [x] Create `docs/schema.json` with canonical column definitions and `schema_version: 1`.
- [x] Add `docs/schema.md` describing the schema, versioning policy and migration guidance.
- [x] Add example CSV `dados/samples/ticker_example.csv` with representative rows and header.
- [x] Add unit test `tests/test_schema.py` to validate `dados/samples/ticker_example.csv` against `docs/schema.json` using `pandera` or lightweight validator.
- [x] Reference schema in `docs/implementation-artifacts/1-1-implementar-interface-de-adapter-e-adaptador-yfinance-minimo.md` and adapter mappings (adicionado referência em 1-1).
- [x] Update `docs/implementation-artifacts/sprint-status.yaml` status for this story to `ready-for-dev` (persisted).
- [x] Documentar o que foi implantado nessa etapa em `docs/sprint-reports` conforme definido no FR28 (`docs/planning-artifacts/prd.md`) (arquivo docs/sprint-reports/1-11-implantacao.md adicionado).

## Dev Notes

- Canonical columns (recommended): `ticker, date, open, high, low, close, adj_close, volume, source, fetched_at, raw_checksum`.
- `date` should be ISO date (`YYYY-MM-DD`) stored as text in SQLite; `fetched_at` as UTC ISO8601 datetime.
- `raw_checksum` is SHA256 hex of raw provider payload or CSV for auditability.
- Use `schema_version` in snapshot metadata and in the header of `docs/schema.json` for migration tracking.
- Validation: recommend `pandera` for DataFrame validation in the mapper stage; provide a simple JSON-driven validator for CI tests.

### File Structure Notes

- `docs/schema.json` — canonical schema definition and semantic notes.
- `docs/schema.md` — human-friendly explanation, migration policy and examples.
- `dados/samples/ticker_example.csv` — example CSV referenced by docs and tests.

### Testing Requirements

- Unit tests to assert example CSV validates against `docs/schema.json`.
- CI job should include a lightweight validation step that loads `docs/schema.json` and validates snapshots produced in tests.

### References

- Source: docs/planning-artifacts/epics.md (Story 1.11)
- Related: docs/planning-artifacts/prd.md (Data model recommendations)

## Dev Agent Record

### Agent Model Used

GPT-5 mini

### Completion Notes List

- Created canonical schema and example artifacts; updated sprint status.
- Implemented artifacts: docs/schema.yaml, docs/schema.md, dados/examples/ticker_example.csv, tests/test_schema.py; added unit test validating schema vs example CSV (tests/test_schema.py). New test executed locally and passed.
- Adicionada referência ao schema em `docs/implementation-artifacts/1-1-implementar-interface-de-adapter-e-adaptador-yfinance-minimo.md`.
- Criado `docs/implementation-artifacts/sprint-status.yaml` e `docs/sprint-reports/1-11-implantacao.md` documentando a implantação.


### File List

- `docs/schema.json` (novo)
- `docs/schema.md` (novo)
- `dados/samples/ticker_example.csv` (novo)
- `tests/test_schema.py` (novo)
- `docs/implementation-artifacts/sprint-status.yaml` (novo)
- `docs/sprint-reports/1-11-implantacao.md` (novo)
- `docs/implementation-artifacts/1-1-implementar-interface-de-adapter-e-adaptador-yfinance-minimo.md` (modificado)

<!-- end file -->

### Change Log

- 2026-02-19 17:32:34 -0300 — 514f81b — phbr — story 1-11: mark tasks done, add schema/docs/examples/tests (fix lint) — adiciona schema (docs/schema.json), docs (docs/schema.md), exemplo CSV (dados/samples/ticker_example.csv) e teste (tests/test_schema.py).

### Tests Executed

- Comando: poetry run pytest -q tests/test_schema.py
- Resultado: 1 teste executado — passou ('.' [100%]).

### Implementation Summary

- Criado o esquema canônico em `docs/schema.json` com `schema_version: 1` e notas semânticas para cada coluna.
- Adicionada documentação em `docs/schema.md` explicando campos, a política de versionamento e orientações de migração (minor vs breaking).
- Incluído exemplo CSV em `dados/samples/ticker_example.csv` com linhas representativas e colunas de metadados (`fetched_at`, `raw_checksum`).
- Adicionado teste unitário `tests/test_schema.py` que valida a ordem das colunas e formatos essenciais (date, fetched_at, raw_checksum).

### Pendências

- Referenciar o schema nos artefatos de adapter/mapping: `docs/implementation-artifacts/1-1-implementar-interface-de-adapter-e-adaptador-yfinance-minimo.md` (pendência técnica).
- Atualizar `docs/implementation-artifacts/sprint-status.yaml` (não encontrado no repositório) e registrar o deployment em `docs/sprint-reports` conforme FR28.

### Recomendações

- Incluir validação de DataFrame (ex.: `pandera`) ou validador JSON-driven no pipeline e na CI para validar snapshots antes de publicação.
- Adicionar um passo de verificação de schema na CI que falhe se snapshots de produção divergirem do `docs/schema.json`.

Issue: https://github.com/phbrgnomo/Analise-financeira-B3/issues/113
